{"code":"(()=>{\n\"use strict\";var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,\"default\",{value:mod,enumerable:true}):target,mod));var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var user_controller_exports={};__export(user_controller_exports,{default:()=>user_controller_default});module.exports=__toCommonJS(user_controller_exports);var import_aws_sdk=__toESM(require(\"aws-sdk\"));var import_formatedReturn=require(\"../helpers/formatedReturn\");import_aws_sdk.default.config.update({region:process.env.AWS_REGION,accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY});const TABLE_NAME=process.env.TABLE_AWS||\"dbLunar2\";const dynamoDB=new import_aws_sdk.default.DynamoDB.DocumentClient;class UserController{static{__name(this,\"UserController\")}constructor(){}async auth(req,res){const{user,password}=req.body;if(!user||!password){return res.status(400).json({error:\"Os par\\xE2metros 'user' e 'password' s\\xE3o obrigat\\xF3rios.\"})}try{const params={TableName:TABLE_NAME,IndexName:\"user-index\",KeyConditionExpression:\"#user = :user\",ExpressionAttributeNames:{\"#user\":\"user\"},ExpressionAttributeValues:{\":user\":user}};const result=await dynamoDB.query(params).promise();if(!result.Items||result.Items.length===0){return res.status(404).json({error:\"Usu\\xE1rio n\\xE3o encontrado.\"})}const userFound=result.Items[0];if(userFound.password!==password){return res.status(401).json({error:\"Senha incorreta.\"})}const formatReturnUsers=(0,import_formatedReturn.formatedReturn)(userFound);res.status(200).json(formatReturnUsers)}catch(error){console.error(\"Erro ao buscar usu\\xE1rio:\",error);res.status(500).json({error:\"Erro ao buscar usu\\xE1rio\",details:error})}}async createUser(req,res){try{const{name,user,age,password,userWtp,phone,role,subRole,status,points=0,books=[],subs=[],isDeleted=false}=req.body;if(!name||!user||!password||!userWtp){return res.status(400).json({error:\"Campos obrigat\\xF3rios est\\xE3o faltando.\"})}const checkUser=await dynamoDB.query({TableName:TABLE_NAME,IndexName:\"userWtp-index\",KeyConditionExpression:\"userWtp = :userWtp\",ExpressionAttributeValues:{\":userWtp\":userWtp}}).promise();if(checkUser.Items&&checkUser.Items.length>0){return res.status(409).json({error:\"Usu\\xE1rio j\\xE1 existe.\"})}const params={TableName:TABLE_NAME,Item:{user:userWtp,name,age:Number(age)||0,password,userWtp,phone,role,subRole,status,points:Number(points),books,subs,isDeleted}};await dynamoDB.put(params).promise();console.log(\"Usu\\xE1rio criado com sucesso:\",params.Item);res.status(201).json({message:\"Usu\\xE1rio criado com sucesso\",user:params.Item})}catch(error){console.error(\"Erro inesperado ao criar usu\\xE1rio:\",error);res.status(500).json({error:\"Erro inesperado no servidor\",details:error})}}async getAllUsers(req,res){try{const params={TableName:TABLE_NAME};const result=await dynamoDB.scan(params).promise();if(!result.Items||result.Items.length===0){return res.status(404).json({error:\"Nenhum usu\\xE1rio encontrado.\"})}const formatReturnUsers=(0,import_formatedReturn.formatedReturnToAll)(result.Items);res.status(200).json(formatReturnUsers)}catch(error){console.error(\"Erro ao buscar usu\\xE1rios:\",error);res.status(500).json({error:\"Erro ao buscar usu\\xE1rios\",details:error})}}async getUserByWtp(req,res){const{userWtp}=req.query;if(!userWtp){return res.status(400).json({error:\"O par\\xE2metro 'userWtp' \\xE9 obrigat\\xF3rio.\"})}try{const result=await dynamoDB.query({TableName:TABLE_NAME,IndexName:\"userWtp-index\",KeyConditionExpression:\"userWtp = :userWtp\",ExpressionAttributeValues:{\":userWtp\":userWtp}}).promise();if(!result.Items||result.Items.length===0){return res.status(404).json({error:\"Usu\\xE1rio n\\xE3o encontrado.\"})}const formatReturnUsers=(0,import_formatedReturn.formatedReturn)(result.Items[0]);res.status(200).json(formatReturnUsers)}catch(error){console.error(\"Erro ao buscar usu\\xE1rio:\",error);res.status(500).json({error:\"Erro ao buscar usu\\xE1rio\",details:error})}}async updateUser(req,res){const{userWtps}=req.params;console.log(\"userWtps:\",userWtps);if(!userWtps){return res.status(400).json({error:\"O par\\xE2metro 'userWtp' \\xE9 obrigat\\xF3rio.\"})}try{const results=await dynamoDB.query({TableName:TABLE_NAME,IndexName:\"userWtp-index\",KeyConditionExpression:\"userWtp = :userWtp\",ExpressionAttributeValues:{\":userWtp\":userWtps}}).promise();if(!results.Items||results.Items.length===0){return res.status(404).json({error:\"Usu\\xE1rio n\\xE3o encontrado.\"})}console.log(\"Usu\\xE1rio encontrado:\",results.Items[0]);const{name,age,password,userWtp,phone,role,subRole,status,points,books,subs,isDeleted}=req.body;const params={TableName:TABLE_NAME,Key:{user:results.Items[0].user},UpdateExpression:`set #name = :name, age = :age, password = :password, userWtp = :userWtp, phone = :phone, #role = :role, subRole = :subRole, #status = :status, points = :points, books = :books, subs = :subs, isDeleted = :isDeleted`,ExpressionAttributeNames:{\"#name\":\"name\",\"#role\":\"role\",\"#status\":\"status\"},ExpressionAttributeValues:{\":name\":name||results.Items[0].name,\":age\":age||results.Items[0].age,\":password\":password||results.Items[0].password,\":userWtp\":userWtp||results.Items[0].userWtp,\":phone\":phone||results.Items[0].phone,\":role\":role||results.Items[0].role,\":subRole\":subRole||results.Items[0].subRole,\":status\":status||results.Items[0].status,\":points\":points||results.Items[0].points,\":books\":books||results.Items[0].books,\":subs\":subs||results.Items[0].subs,\":isDeleted\":isDeleted||results.Items[0].isDeleted},ReturnValues:\"UPDATED_NEW\"};const result=await dynamoDB.update(params).promise();console.log(\"Usu\\xE1rio atualizado com sucesso:\",result.Attributes);const formatReturnUsers=(0,import_formatedReturn.formatedReturn)(result.Attributes);res.status(200).json(formatReturnUsers)}catch(error){console.error(\"Erro ao atualizar usu\\xE1rio:\",error);res.status(500).json({error:\"Erro ao atualizar usu\\xE1rio\",details:error})}}}var user_controller_default=UserController;\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":["AWS"],"ignoreList":[],"sources":["C:\\Users\\Bushido\\Documents\\my-apps\\AppLunar-2.0\\AppLunar2.0\\server\\src\\controller\\user.controller.ts"],"sourcesContent":[null]}}